name: Verify Code Vulnerabilities
on:
  pull_request: {}
  push:
    branches:
    - main
    - master
jobs:
  verify-code-vulnerabilities:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Trivy
        run: |
          curl -L https://github.com/aquasecurity/trivy/releases/download/v0.20.2/trivy_linux_amd64 -o trivy
          chmod +x trivy
          mv trivy /usr/local/bin
      - name: Run Trivy
        run: |
          trivy image --exit-code 1 --severity CRITICAL,HIGH .

    if: github.event_name == 'pull_request'
